buildscript {
    repositories {
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }
    dependencies {
        classpath "gradle.plugin.com.github.harbby:gradle-serviceloader:1.1.5"
    }
}


def title = "Graylog-Plugin-AlertManager-Callback"

apply plugin: "com.github.harbby.gradle.serviceloader"
apply plugin: 'java'
apply plugin: 'idea'
apply plugin: "jacoco"

jacoco {
    toolVersion = "0.8.2"
}

serviceLoader {
    serviceInterface 'org.graylog2.plugin.Plugin'
}

group = 'de.gdata.mobilelab'
version = "1.2.0"

sourceCompatibility = 1.8
targetCompatibility = 1.8

task version {
    doFirst {
        println(version)
    }
}

repositories {
    maven {
        url "https://plugins.gradle.org/m2/"
    }
    maven { url 'http://repo.spring.io/plugins-release/'}
}

dependencies {
    // https://mvnrepository.com/artifact/org.graylog2/graylog2-server
    implementation group: 'org.graylog2', name: 'graylog2-server', version: '3.3.5'

    // https://mvnrepository.com/artifact/org.jboss.dashboard-builder/dashboard-builder-bom
    implementation group: 'org.jboss.dashboard-builder', name: 'dashboard-builder-bom', version: '6.5.0.Final', ext: 'pom'

    // https://mvnrepository.com/artifact/com.google.auto.value/auto-value
    compileOnly group: 'com.google.auto.value', name: 'auto-value', version: '1.7.4'

    // https://mvnrepository.com/artifact/org.projectlombok/lombok
    implementation group: 'org.projectlombok', name: 'lombok', version: '1.18.12'
    annotationProcessor('org.projectlombok:lombok:1.18.12')

    // TESTS

    // https://mvnrepository.com/artifact/org.springframework/spring-web
    testImplementation group: 'org.springframework', name: 'spring-web', version: '5.2.8.RELEASE'

    // https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind
    testImplementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.11.2'

    testImplementation group: 'junit', name: 'junit', version: '4.13'
    
    // https://mvnrepository.com/artifact/org.mockito/mockito-core
    testImplementation group: 'org.mockito', name: 'mockito-core', version: '3.5.0'

    // https://mvnrepository.com/artifact/org.testcontainers/testcontainers
    testImplementation group: 'org.testcontainers', name: 'testcontainers', version: '1.14.3'

}

jar {
    archiveFileName = "graylog-plugin-alertmanagercallback-" + version + ".jar"
    archiveBaseName = title
    group = "de.gdata.mobilelab.alertmanagercallback"
    manifest {
        attributes(
                'Implementation-Title': title,
                'Implementation-Version': archiveVersion,
                'Build-Time': new Date().format("yyy-MM-dd HH:mm:ss"),
                'Graylog-Plugin-Properties-Path': 'de.gdata.mobilelab.alertmanagercallback.graylog-plugin-alertmanagercallback'
        )
    }
}

jacocoTestReport {
    reports {
        xml.enabled true
        xml.destination new File("${buildDir}/reports/jacoco/report.xml")
        csv.enabled false
        html.enabled false
    }
}
